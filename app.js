var app,board,hashAppend,hashList,hashLoad,hashRemove,hashToggle,paginate,__indexOf=[].indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1};board=document.querySelector(".board"),hashList=function(){var e,t,n,r,i;for(r=window.location.hash.substring(1).split("-"),i=[],t=0,n=r.length;n>t;t++)e=r[t],e&&i.push(e);return i},hashToggle=function(e){return __indexOf.call(hashList(),e)>=0?hashRemove(e):hashAppend(e)},hashRemove=function(e){return window.location.hash=hashList().filter(function(t){return t!==e}).join("-")},hashAppend=function(e){return __indexOf.call(hashList(),e)<0?window.location.hash=hashList().concat(e).sort(function(e,t){return parseInt(e,16)-parseInt(t,16)}).join("-"):void 0},hashLoad=function(e){return window.location.hash=e.sort(function(e,t){return parseInt(e,16)-parseInt(t,16)}).join("-")},null==localStorage.hash||hashList().length||(window.location.hash=localStorage.hash),function(){var e;return e=document.createElement("div"),e.className="progress",document.body.appendChild(e),window.progress={speed:500,start:function(){return this.go(.01)},done:function(){return this.go(1)},val:function(){return.01*parseInt(e.style.width||0)},cancel:function(t){return null==t&&(t=0),setTimeout(function(){return e.style.opacity=0},t+300),setTimeout(function(){return e.style.width=0},t+300+this.speed)},go:function(t,n){return null==n&&(n=!1),n!==!1&&(this.speed=n),e.style.webKitTransition=e.style.transition="opacity .3s, width "+this.speed/1e3+"s",e.style.opacity=1,t=Math.min(1,Math.max(0,t)),e.style.width=100*t+"%",1===t?progress.cancel(progress.speed):void 0}}}(),app=angular.module("aboard",[]),app.filter("mature",function(){return function(e){return __indexOf.call(e.split(" "),"mature")>=0?"*":""}}),app.filter("hashList",function(){return function(e){var t,n,r,i,o;for(o=[],n=0,r=e.length;r>n;n++)t=e[n],i=t.id,__indexOf.call(hashList(),i)>=0&&o.push(t);return o}}),app.filter("inHashList",function(){return function(e){return __indexOf.call(hashList(),e)>=0}}),paginate=5,app.controller("main",["$scope","$http","$compile",function(e,t,n){var r,i;return i=[[],[],!1,0,0,paginate-1,!1],e.feeds=i[0],e.items=i[1],e.total=i[2],e.loading=i[3],e.current=i[4],e.fit=i[5],e.limit=i[6],r=t.jsonp("http://spreadsheets.google.com/feeds/list/1QgkAchwwtS8IH9GPBD-LPLY41_okXHGHw7UTFGa-a18/od6/public/basic?alt=json-in-script&callback=JSON_CALLBACK"),r.success(function(t){var n;return e.feeds=function(){var e,r,i,o;for(i=t.feed.entry,o=[],e=0,r=i.length;r>e;e++)n=i[e],o.push(JSON.parse('{"id":"'+n.title.$t+'", '+n.content.$t.replace(/([a-z]+)[\s]*\:[\s]*([^,]+)/g,'"$1":"$2"')+"}"));return o}().filter(function(e){return"0"!==e.online}),hashList().length?e.loadItems():hashLoad(function(){var t,r,i,o;for(i=e.feeds,o=[],t=0,r=i.length;r>t;t++)n=i[t],"1"===n.status&&o.push(n.id);return o}())}),e.loadFeed=function(t){var n,r,i;return n=function(){var n,i,o,s;for(o=e.feeds,s=[],n=0,i=o.length;i>n;n++)r=o[n],r.id===t&&s.push(r);return s}().pop(),i=new XMLHttpRequest,i.open("GET","http://cors-anywhere.herokuapp.com/"+n.feed),i.onerror=i.onload=function(){var t,o,s,a,u;if(console.log(n.name),t=xmlToJSON.parseString(i.responseText,{xmlns:!1,childrenAsArray:!1,textKey:"t"}),null!=t.rss)for(u=t.rss.channel.item,s=0,a=u.length;a>s;s++)r=u[s],null!=r.title&&null!=r.pubDate&&null!=r.link&&e.items.push({feed:n.id,source:n.url.replace(/^http(?:s)?\:\/\/([^\/]+)\/*$/,"$1"),title:r.title.t,date:new Date(r.pubDate.t),url:r.link.t,image:(o=(r.description.t||r.encoded.t).match(/<img[^<>]+src=[\"\']([^\"\']+)[\"\'][^<>]*>/))?o[1].replace(/\&amp;/g,"&"):!1});return e.items=e.items.filter(function(e){return e.image}),e.setCurrent(e.current),e.loading--,progress.go(1-e.loading/e.total),e.loading?void 0:(e.limit=e.fit,e.fill())},i.send(null)},e.loadItems=function(){var t,n,r,i,o;for(progress.start(),e.items=e.items.filter(function(e){var t;return t=e.feed,__indexOf.call(hashList(),t)>=0}),e.loading=hashList().filter(function(t){var n;return __indexOf.call(function(){var t,r,i,o;for(i=e.items,o=[],t=0,r=i.length;r>t;t++)n=i[t],o.push(n.feed);return o}(),t)<0}).length,e.total=e.loading,o=hashList(),r=0,i=o.length;i>r;r++)t=o[r],__indexOf.call(function(){var t,r,i,o;for(i=e.items,o=[],t=0,r=i.length;r>t;t++)n=i[t],o.push(n.feed);return o}(),t)<0&&e.loadFeed(t);return e.$$phase?void 0:e.$apply()},e.resetCurrent=function(){return e.setCurrent(!1)},e.setCurrent=function(t){var n,r,i;return i=[t,0,document.querySelector("#feed-"+t),document.querySelector(".nav-feeds")],e.current=i[0],document.body.scrollTop=i[1],n=i[2],r=i[3],n&&(r.scrollLeft=n.offsetLeft-r.offsetLeft-r.offsetWidth/2+n.offsetWidth/2),e.loading||(e.limit=e.fit),e.$$phase?void 0:e.$apply()},e.more=function(){return e.limit+=paginate,e.$$phase?void 0:e.$apply()},e.fill=function(){return e.more(),board.clientHeight<=1.1*window.innerHeight?setTimeout(arguments.callee,10):e.fit=e.limit},window.addEventListener("scroll",function(){return document.body.scrollTop>document.body.scrollHeight-1.2*window.innerHeight&&e.limit<e.items.length?e.more():void 0}),window.addEventListener("hashchange",function(){return localStorage.hash=window.location.hash.substring(1),e.loadItems()}),window.addEventListener("keydown",function(t){var n;switch(t.which){case 37:n=e.current?document.querySelector("#feed-"+e.current).previousSibling:document.querySelector(".nav-feed:last-child");break;case 39:n=e.current?document.querySelector("#feed-"+e.current).nextSibling:document.querySelector(".nav-feed:first-child")}return n?n.getAttribute?e.setCurrent(n.getAttribute("id").replace("feed-","")):e.resetCurrent():void 0})}]),app.controller("feed",["$scope","$http",function(e,t){return e.showItems=function(){return e.setCurrent(e.feed.id)},e.toggleFeed=function(){var t;return hashToggle(e.feed.id),e.setCurrent((t=e.feed.id,__indexOf.call(hashList(),t)>=0?e.feed.id:!1))}}]),function(){var e,t,n,r,i,o,s,a;return s=function(){var e,n,r,i;for(r=["logo","wave","boat"],i=[],e=0,n=r.length;n>e;e++)t=r[e],i.push(document.getElementById(t));return i}(),n=s[0],o=s[1],e=s[2],a=[0,!1],r=a[0],i=a[1],n.addEventListener("mouseout",function(){return clearInterval(i)}),n.addEventListener("mouseover",function(){var t,n,s;return s=[1e3/24,4],n=s[0],t=s[1],i=setInterval(function(){var i;return i=t*Math.sin(r*Math.PI*n/1e3/2),o.setAttribute("transform","translate(-"+i+")"),e.setAttribute("transform","translate("+i+")"),r++},n)})}();
