function parseAccept(e){return e.split(",").map(function(e){return parseMediaType(e.trim())}).filter(function(e){return e&&e.q>0})}function parseMediaType(e){var t=e.match(/\s*(\S+)\/([^;\s]+)\s*(?:;(.*))?/);if(!t)return null;var n=t[1],r=t[2],i=""+n+"/"+r,s={},o=1;if(t[3]){s=t[3].split(";").map(function(e){return e.trim().split("=")}).reduce(function(e,t){e[t[0]]=t[1];return e},s);if(s.q!=null){o=parseFloat(s.q);delete s.q}}return{type:n,subtype:r,params:s,q:o,full:i}}function getMediaTypePriority(e,t){return(t.filter(function(t){return specify(e,t)}).sort(function(e,t){return e.q>t.q?-1:1})[0]||{q:0}).q}function specifies(e,t){return e==="*"||e===t}function specify(e,t){var n=parseMediaType(e);if(t.params){var r=Object.keys(t.params);if(r.some(function(e){return!specifies(t.params[e],n.params[e])}))return null}if(specifies(t.type,n.type)&&specifies(t.subtype,n.subtype))return t}function preferredMediaTypes(e,t){e=parseAccept(e||"");return t?t.map(function(t){return[t,getMediaTypePriority(t,e)]}).filter(function(e){return e[1]>0}).sort(function(e,t){return e[1]===t[1]?0:e[1]>t[1]?-1:1}).map(function(e){return e[0]}):e.sort(function(e,t){return e.q<t.q?1:-1}).map(function(e){return e.full})}module.exports=preferredMediaTypes;preferredMediaTypes.preferredMediaTypes=preferredMediaTypes;